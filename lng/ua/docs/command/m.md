

**Опция -m (установить алгоритм сжатия)**

--------------------------------------------------------------------------------

Указывает алгоритм сжатия.

**Синтаксис**

`-m<параметры_метода>`: Формат этой опции зависит от типа архива.

**Zip**

| Параметр       | Значение по умолчанию | Описание                                                                    |
|---------------|-----------------------|------------------------------------------------------------------------------|
| `x=[0 | 5 | 9]` | `5`                   | Устанавливает уровень сжатия.                                             |
| `m={MethodID}` | `Deflate`             | Устанавливает алгоритм сжатия: `Copy`, `Deflate`, `Deflate64`, `BZip2`.  |
| `fb={NumFastBytes}` | `32`                   | Устанавливает размер слова для кодировщика Deflate.                     |
| `pass={NumPasses}` | `1`                   | Устанавливает размер передачи для кодировщика Deflate.                 |

`x=[0 | 5 | 9]`

Устанавливает уровень сжатия:

| Уровень сжатия | Описание                                                                  |
|-----------------|----------------------------------------------------------------------------|
| `0`              | Не сжимать.                                                              |
| `5`              | Уровень сжатия по умолчанию.                                              |
| `9`              | Максимальный уровень сжатия. Сжатые файлы будут меньше, но сжатие будет медленнее и потребуется больше оперативной памяти. |

`fb={NumFastBytes}`: Устанавливает размер слова для кодировщика Deflate. Вы можете изменить его в диапазоне от 3 до 255. Его значение по умолчанию равно 32 для алгоритма Deflate и 64 для алгоритма Deflate64. Если несколько сжимаемых файлов имеют много одинаково расположенных байтов, например, два простых текстовых документа с очень похожим содержимым и форматом, то сжатие с большим размером слова в определенной степени увеличит коэффициент сжатия. Поэтому, как правило, чем больше это значение, тем меньше будет сжатый файл. Но сжатие и распаковка будут медленнее и потребуется больше оперативной памяти.

`pass={NumPasses}`: Устанавливает размер передачи для кодировщика Deflate. Вы можете изменить его в диапазоне от 1 до 4. Его значение по умолчанию равно 1 для алгоритма Deflate и 3 для алгоритма Deflate64. Этот параметр может немного улучшить коэффициент сжатия, но не существенно.

**GZip**

GZip использует те же параметры, что и Zip, за исключением того, что GZip не поддерживает алгоритм сжатия "Store".

**7z**

| Параметр      | Значение по умолчанию | Описание                                                                                                                          |
|--------------|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| `x=[0 | 1 | 5 | 7 | 9]` | `5`                   | Устанавливает уровень сжатия.                                                                                              |
| `s=[off | on | [e] [{N}f] [{N}b | {N}k | {N}m | {N}g]]` | `on`                   | Устанавливает режим твердого тела (solid mode).                                                                                        |
| `f=[off | on]` | `on`                   | Включает или выключает фильтр сжатия исполняемых файлов.                                                                                           |
| `hc=[off | on]` | `on`                   | Включает или выключает сжатие заголовков файлов.                                                                                       |
| `hcf=[off | on]` | `on`                   | Включает или выключает полное сжатие заголовков файлов.                                                                                 |
| `he=[off | on]` | `off`                  | Включает или выключает шифрование заголовков файлов.                                                                                   |
| `b{C1}[s{S1}]:{C2}[s{S2}]` |                       | Устанавливает связывание между кодировщиками.                                                                                                 |
| `{N}={MethodID}[:param1][:param2][..]` | `LZMA`              | Устанавливает алгоритм сжатия: `LZMA`, `PPMd`, `BZip2`, `Deflate`, `BCJ`, `BCJ2`, `Copy`.                                                               |
| `mt=[off | on]` | `off`                  | Устанавливает многопоточный режим.                                                                                                |

`x=[0 | 1 | 5 | 7 | 9]`

Устанавливает уровень сжатия:

| Уровень сжатия | Описание                                                                                                                |
|-----------------|------------------------------------------------------------------------------------------------------------------------|
| `0`              | Не сжимать.                                                                                                          |
| `1`              | Быстрое сжатие: быстрый алгоритм LZMA, размер словаря 32 KB, поисковик совпадений HC3, фильтр BCJ.                          |
| `5`              | Нормальное сжатие: стандартный алгоритм LZMA, размер словаря 2 MB, поисковик совпадений BT4, размер слова 32, фильтр BCJ. |
| `7`              | Максимальное сжатие: максимальный алгоритм LZMA, размер словаря 8 MB, поисковик совпадений BT4, размер слова 64, фильтр BCJ. |
| `9`              | Экстремальное сжатие: максимальный алгоритм LZMA, размер словаря 32 MB, поисковик совпадений BT4b, размер слова 64, фильтр BCJ2. |

`s=[off | on | [e] [{N}f] [{N}b | {N}k | {N}m | {N}g]]`: Включает или отключает режим "твердого тела" (solid mode). Значение по умолчанию для этой опции - `s=on`. В режиме твердого сжатия все файлы в архиве рассматриваются как непрерывный поток данных. Как правило, твердое сжатие может увеличить коэффициент сжатия, особенно при добавлении большого количества небольших файлов.
* `e` Использует отдельные потоки твердых данных для каждого расширения файла
* `{N}f` Устанавливает количество файлов в одном потоке твердых данных
* `{N}b | {N}k | {N}m | {N}g` Устанавливает размер потока твердых данных (в байтах)
Различные уровни сжатия имеют ограничения на размер потока твердых данных:

| Уровень сжатия | Размер      |
|-----------------|-------------|
| Store           | 0 B         |
| Fast            | 16 MB       |
| Normal          | 256 MB      |
| Maximum         | 1 GB        |
| Extreme         | 4 GB        |
Ограничения на размер потока твердых данных, хотя и влияют на коэффициент сжатия, имеют ряд преимуществ: в случае повреждения архива не будут потеряны все данные; сокращается время извлечения файлов.

В текущей версии вы можете только обновлять архивы, которые не были сжаты с включенным режимом "твердого тела". То есть текущая версия не поддерживает обновление архивов с "твердым телом".

Пример: `-s=100f10m`: Установите режим твердого тела, чтобы каждый поток твердых данных содержал не более 100 файлов и имел максимальный размер 10 МБ.

`f=[off | on]`: Включает или отключает фильтр сжатия исполняемых файлов: dll, exe, ocx, sfx, sys. Он используется в фильтре BCJ2 (с использованием экстремального сжатия) и фильтре BCJ. Значение по умолчанию для этой опции - `f=on`.

`hc=[off | on]`: Включает или отключает сжатие заголовков файлов. Значение по умолчанию для этой опции - `hc=on`. Если включено сжатие заголовков файлов, часть заголовков файлов будет сжата с использованием алгоритма LZMA.

`hcf=[off | on]`: Включает или отключает полное сжатие заголовков файлов. Значение по умолчанию для этой опции - `hcf=on`. Если включено полное сжатие заголовков файлов, этот архив будет поддерживаться только версиями HaoZip 2.30 beta 25 и выше.

`he=[off | on]`: Включает или отключает шифрование заголовков файлов. Значение по умолчанию для этой опции - `he=off`.

`{N}`: Устанавливает порядок алгоритмов. Он используется как параметр связывания алгоритмов. Минимальное значение - 0. Алгоритм с запятой будет использоваться первым.

`b{C1}[s{S1}]:{C2}[s{S2}]`: Связывает выходной поток S1, закодированный кодировщиком C1, с входным потоком S2, закодированным кодировщиком C2. Если номер потока данных не указан, потоком данных по умолчанию является S0. Как правило, кодировщик имеет один входной и один выходной потоки. Но в 2345 HaoZip некоторые кодировщики имеют несколько входных и выходных потоков. Например, кодировщик BCJ2 имеет один входной и четыре выходных потока.

`mt=[off | on]`: Включает или отключает многопоточное сжатие. В режиме многопоточной поддержки 2345 HaoZip будет использовать два потока для сжатия. Таким образом, для многопроцессорных систем скорость сжатия увеличится на 70-80%. Для процессоров Pentium 4 с Hyper-Threading скорость сжатия увеличится примерно на 25%. Но при распаковке используется только один поток. Внимание! Эта опция действительна только для алгоритма сжатия LZMA.

`{N}={MethodID}[:param1][:param2] ... [:paramN]`: Устанавливает алгоритм сжатия. В формате 7z вы можете использовать множество алгоритмов сжатия. Алгоритм по умолчанию для этой опции - LZMA. Этот параметр должен быть одним из следующих форматов: `{ParamName}={ParamValue}`; `{ParamName}{ParamValue}`, где `{ParamValue}` - это числовое значение, и `{ParamName}` не содержит цифр.

Поддерживаемые алгоритмы сжатия:

| MethodID | Описание                                                                                                                                                                                                                                                                     |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `LZMA`   | Алгоритм сжатия на основе LZ (Lempel-Ziv), разработанный совместно израильскими математиками A.Lempel и J.Ziv. Он обеспечивает относительно быструю скорость распаковки (примерно в 10-20 раз быстрее, чем сжатие). Требования к памяти также различаются (см. опцию d={Size}[b|k|m] для получения дополнительной информации). |
| `PPMd`   | Алгоритм PPM-based сжатия. Он основан на алгоритме PPMdH Дмитрия Шкарина и оптимизирован для его исходного кода. Обычно обеспечивает высокий коэффициент сжатия и быструю скорость распаковки чистого текста.                                                            |
| `BZip2`  | Стандартный алгоритм сжатия на основе BWT. Обычно обеспечивает высокий коэффициент сжатия чистого текста и довольно хорошую скорость распаковки.                                                                                                                           |
| `Deflate`| Стандартный алгоритм сжатия для форматов ZIP и GZip. Не имеет высокого коэффициента сжатия. Но у него очень быстрая скорость сжатия и распаковки. Алгоритм сжатия Deflate поддерживает только размер словаря 32 KB.                                                              |
| `BCJ`    | (CALL, JUMP) 32-разрядный преобразователь исполняемых файлов x86.                                                                                                                                                                                                             |
| `BCJ2`   | (CALL, JUMP, JCC) 32-разрядный преобразователь исполняемых файлов x86 (вторая версия).                                                                                                                                                                                          |
| `Copy`   | Не сжимать.                                                                                                                                                                                                                                                                  |

**LZMA**

LZMA - это алгоритм сжатия, основанный на Lempel-Ziv (алгоритм сжатия, разработанный совместно израильскими математиками A.Lempel и J.Ziv). Он может обеспечить относительно быструю скорость распаковки (примерно в 10-20 раз быстрее, чем сжатие). Требования к памяти также различны (см. опцию d={Size}[b|k|m] для получения дополнительной информации).

| Параметр       | Значение по умолчанию | Описание                                                                                                                                                                                                                                           |
|---------------|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `a=[0|1|2]`    | `1`                   | Устанавливает уровень сжатия: 0 = быстрый, 1 = нормальный, 2 = максимальный. Значение по умолчанию - 1.                                                                                                                                           |
| `d={Size}[b|k|m]` | `20`                   | Устанавливает размер словаря для алгоритма сжатия LZMA. Вы можете указать это значение в байтах, КБ или МБ. Максимальный размер словаря - 256 МБ = 2^28 байт. Размер словаря LZMA по умолчанию в нормальном режиме - 21 (2 МБ); в максимальном режиме (-mx=7) - 23 (8 МБ); в экстремальном режиме (-mx=9) - 25 (32 МБ). Для распаковки файлов, сжатых с помощью алгоритма LZMA, требуется 64 МБ доступной физической памяти, если размер словаря сжатого файла составляет 64 МБ. |
| `mf={MF_ID}`   | `bt4`                  | Устанавливает сопоставитель для алгоритма сжатия LZMA. Алгоритм по умолчанию - bt4. Алгоритмы bt* требуют меньше памяти, чем алгоритмы pat*. Как правило, bt4 работает намного быстрее, чем pat*, однако некоторые форматы файлов могут работать быстро с алгоритмом pat*. Алгоритмы hc* не имеют хорошего коэффициента сжатия, но обычно работают довольно быстро при использовании в сочетании с быстрым режимом (a=0). Необходимая память зависит от размера словаря (см. таблицу ниже).  |
| `fb={N}`      | `32`                   | Устанавливает размер слова для алгоритма сжатия LZMA. Допустимый диапазон - от 5 до 273. Значение по умолчанию - 32 в нормальном режиме и 64 в максимальном режиме. Как правило, большее значение может немного улучшить коэффициент сжатия. Но это также замедлит скорость сжатия.                                                                                                                      |
| `lc={N}`      | `3`                    | Устанавливает количество битов контекста литералов. Допустимый диапазон - от 0 до 8. Значение по умолчанию - 3. Иногда для файлов с большими файлами автоматически используется lc=4.                                                      |
| `lp={N}`      | `0`                    | Устанавливает количество битов позиции литералов. Допустимый диапазон - от 0 до 4. Значение по умолчанию - 0.                                                                                                                            |
| `pb={N}`      | `2`                    | Устанавливает количество битов позиции. Допустимый диапазон - от 0 до 4. Значение по умолчанию - 2.                                                                                                                            |

**PPMd**

PPMd - это сокращение от PPM-based алгоритма сжатия. Он основан на алгоритме PPMdH Дмитрия Шкарина и оптимизирован для его исходного кода. PPMd обычно обеспечивает высокий коэффициент сжатия чистого текста и быструю скорость распаковки. Скорость сжатия и распаковки полностью одинаковы, также как и необходимый размер памяти.

| Параметр       | Значение по умолчанию | Описание                                                                                                                                                                                                                       |
|---------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `mem={Size}[b|k|m]` | `24`                   | Устанавливает объем памяти, используемой алгоритмом PPMd. Вы можете указать это значение в байтах, КБ или МБ. Максимальное значение - 2 ГБ = 2^31 байт; Значение по умолчанию - 24 (16 МБ). Если вы не укажете элемент [b|k|m], размер словаря будет автоматически выбран в соответствии с уровнем сжатия. PPMd требует одинакового объема памяти во время сжатия и распаковки. |
| `o={Size}`      | `6`                   | Устанавливает команду сжатия для алгоритма PPMd. Его размер должен быть в диапазоне [2,32]. Значение по умолчанию - 6.                                                                                                                    |

**BCJ2**

BCJ2 - это 32-разрядный преобразователь исполняемых файлов x86 (вторая версия). Он сжимает файлы далее, преобразуя инструкции ветвления.

Кодировщик BCJ2 имеет один входной поток и четыре выходных потока:

* `s0`: Основной поток. Требует дальнейшего сжатия.
* `s1`: Поток преобразования значений CALL. Требует дальнейшего сжатия.
* `s2`: Поток преобразования значений JUMP. Требует дальнейшего сжатия.
* `s3`: Сервисный поток. Уже сжат.

При использовании алгоритма сжатия LZMA размеры словарей потоков `s1` и `s2` могут быть намного меньше, чем у потока `s0` (в большинстве случаев достаточно 512 КБ).

**Примеры**

* `HaoZipC a -tzip archive.zip *.jpg -mx0`: Добавить файлы `*.jpg` в архив `archive.zip` без сжатия.
* `HaoZipC a -t7z archive.7z *.exe *.dll -m0=BCJ -m1=LZMA:d=21 -ms -mmt`: Добавить файлы `*.exe` и `*.dll` в архив с "твердым телом" `archive.7z`. Использовать алгоритм сжатия LZMA, размер словаря 2 МБ и преобразователь BCJ. Включить многопоточную оптимизацию (если доступна).
* `HaoZipC a -t7z archive.7z *.exe *.dll -m0=BCJ2 -m1=LZMA:d23 -m2=LZMA:d19 -m3=LZMA:d19 -mb0:1 -mb0s1:2 -mb0s2:3`: Добавить файлы `*.exe` и `*.dll` в архив `archive.7z` с использованием преобразователя BCJ2. Основной выходной поток (s0) использует алгоритм сжатия LZMA с размером словаря 8 МБ, а выходные потоки s1 и s2 преобразователя BCJ2 используют алгоритм сжатия LZMA с размером словаря 512 КБ.
* `HaoZipC a -t7z archive.7z *.txt -m0=PPMd`: Добавить файлы `*.txt` в архив `archive.7z`. Использовать алгоритм сжатия PPMd.

**Команды, с которыми можно использовать эту опцию:** `a` (добавить), `d` (удалить), `u` (обновить).

**Другие опции:** `-t` (установить формат архива).
